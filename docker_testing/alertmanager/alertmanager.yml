global: 
  resolve_timeout: 5m # this lets alertmanager to wait this long if Prometheus stops sending alerts before marking it as resolved. Having it be a bit longer is considered good to prevent premature resolutions . 
  # 5m is considered a standard time. 1m would usually be considered aggressive. 
  slack_api_url_file: /run/secrets/slack_webhook
  

route: # this separates alerts by the service and the name of the alert. 
  group_by: ['alertname', 'service_name'] # good format for microservices. One notification per alert type per service. 
  group_wait: 10s # when the first alert arrives, wait this long to send notification for any alerts that may end up in this service in the time span. Prevents spam and constant firing 
  group_interval: 10s  # when a new notification is sent for a group, if any new alerts are added to the group, wait this long for an update. Helps with batch updates instead of one notification per new alert 
  repeat_interval: 12h  # if any alerts are still firing a notification will be resent after this time frame. 
  receiver: 'slack-alerts'

receivers: 
  - name: 'slack-alerts' 
    slack_configs:
      - channel: /run/secrets/slack_channel  # Read channel from secret file
        icon_emoji: ':rotating_light:'
        title: '{{ if eq .Status "firing" }}ðŸš¨{{ else }}âœ…{{ end }} {{ .GroupLabels.alertname }}'
        color: |- # |- is yaml syntax for multiline string that strips new lines. 
          {{if eq .Status "firing"}}danger{{else}}good{{end}}  
        text: |-  # interestingly this is go templating is used for dynamic alerting with alertmanager
          {{ range .Alerts }}
          *Alert:* {{ .Labels.alertname }}
          *Severity:* {{ .Labels.severity }}
          *Service:* {{ .Labels.service_name }}
          *Description:* {{ .Annotations.description }}
          *Status:* {{ .Status }}
          *View in Prometheus:* http://localhost:9090/alerts
          *View in Jaeger:* http://localhost:16686
          {{ end }}
        send_resolved: true  # Send notification when alert is resolved
